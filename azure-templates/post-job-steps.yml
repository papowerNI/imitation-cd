parameters:
  - name: buildOutputLocation
    type: string
  - name: archiveLocation
    type: string
  - name: pack
    type: boolean
    default: false

steps:
###########  Archive  ###########
  - ${{ if eq( parameters.pack, true )}}:
    - powershell: Write-Host "##vso[task.setvariable variable=nipkgPath]$(customDeviceRepoName)\nipkg"
      displayName: set nipkg path variable
    - powershell: |
        rmdir "$(nipkgPath)" /s /q
        mkdir "$(nipkgPath)\control" "$(nipkgPath)\data"
        New-Item "$(nipkgPath)\debian-binary"
        Set-Content "$(nipkgPath)\debian-binary" '2.0\n'
        cp -R "$(customDeviceRepoName)\${{ parameters.buildOutputLocation }}\*" "nipkg\data\documents\National Instruments\NI VeriStand 2020\Custom Devices\National Instruments"
        cp "$(customDeviceRepoName)\control" "$(nipkgPath)"
      displayName: stage nipkg directory
    - script: echo "this is incomplete"
      displayName: Pack nipkg (INCOMPLETE)
  - powershell: |
      Copy-Item `
      -Path "$(customDeviceRepoName)\${{ parameters.buildOutputLocation }}\*" `
      -Destination "${{ parameters.archiveLocation }}\NI\export\$(Build.SourceBranchName)\$(Build.BuildId)\$(lvVersion)\$(architecture)\" `
      -Recurse
    displayName: Copying built files to nirvana Archive